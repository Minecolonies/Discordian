plugins {
    id 'io.franzbecker.gradle-lombok' version '1.12'
    id 'net.ltgt.apt' version '0.10'
    id 'com.github.johnrengelman.shadow' version '5.1.0'
}

version = System.getenv()['BUILD_NUMBER'] != null ? System.getenv()['BUILD_NUMBER'] : System.getenv()['TRAVIS_BUILD_NUMBER']

apply plugin: 'java'
apply plugin: 'idea'
apply plugin: 'application'

sourceCompatibility = 1.8

mainClassName = "co.chatchain.dc.ChatChainDC"

def qsmlDep = 'uk.co.drnaylor:quickstart-moduleloader:0.8.2'

sourceSets {
    main {
        java {
            srcDir 'src/main/java'
        }
        resources {
            srcDir 'src/main/resources'
        }
    }
}

repositories {
    ivy {
        name 'Minecolonies TeamCity Repo'
        ivyPattern 'http://teamcity.minecolonies.com/guestAuth/repository/download/[module]/[revision]/teamcity-ivy.xml'
        artifactPattern 'http://teamcity.minecolonies.com/guestAuth/repository/download/[module]/[revision]/[artifact](.[ext])'
    }
    mavenCentral()
    jcenter()
    maven {
        name 'drnaylor'
        url 'http://repo.drnaylor.co.uk/artifactory/list/quickstart'
    }
}

dependencies {
    compile('org.jetbrains:annotations:15.0')

    //testCompile(group: 'junit', name: 'junit', version: '4.12')
    compile('net.dv8tion:JDA:3.6.0_354')

    compile('org.slf4j:slf4j-api:1.7.25')
    compile('org.slf4j:slf4j-jdk14:1.7.25')
    compileOnly('org.projectlombok:lombok:1.16.18')
    apt('org.projectlombok:lombok:1.16.18')
    compile('ninja.leaping.configurate:configurate-gson:3.3')
    //compile('org.eclipse.mylyn.github:org.eclipse.egit.github.core:2.1.5')

    compile 'org.java-websocket:Java-WebSocket:1.3.4'

    compile('com.jagrosh:jda-utilities-command:2.1')

    //compile 'com.microsoft.signalr:signalr:3.0.0-preview-18579-0056'
    compile 'io.reactivex.rxjava2:rxjava:2.2.2'

    compile('org:ChatChain_ChatChainCommons_Branches:' + chatChainCommonsVersion) {
        artifact {
            name = 'ChatChainCommons-' + chatChainCommonsVersion + '-all'
            type = 'jar'
        }
        artifact {
            name = 'ChatChainCommons-' + chatChainCommonsVersion + '-sources'
            type = 'jar'
            classifier = "sources"
        }
    }
}

shadowJar {
    baseName = 'ChatChainDC'
    classifier = 'all'

    configurations = [project.configurations.compile]
    manifest {
        attributes 'Main-Class': "co.chatchain.dc.ChatChainDC"
    }
}

jar {
    manifest {
        attributes 'Main-Class': "co.chatchain.dc.ChatChainDC"
    }
}